<!doctype html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Ch++ip-8</title>
  </head>
  <body style="padding: 15px">
    <h1>Chip-8 Emulator</h1>
    <div>
      <form onsubmit="return onSubmit()">
        <select name="ROMs" id="fileNameInput">
          <option value="Brick">Brick</option>
          <option value="Fish">&lt;&gt;&lt;</option>
          <option value="IBM">IBM Logo</option>
          <option value="Pong">PONG</option>
          <option value="SI">Space Invaders</option>
        </select>
        <button type="submit">Start emulation</button>
      </form>
      <button onclick="return cancelEmulation()">Stop emulation</button>
  </div>
    <!-- Create the canvas that the C++ code will draw into -->
    <canvas id="canvas" oncontextmenu="event.preventDefault()"></canvas>
    <!-- Allow the C++ to access the canvas element --> 
    <script type='text/javascript'>
      var Module = {
          canvas: (function() { return document.getElementById('canvas'); })()
      };
    </script>
    <script src="./chip8.js"></script>
    <script type="text/javascript">
      let hasRomLoaded = false;
      const loadRom = Module.cwrap('emLoadRom', null, ['string']);
      const stopEmulation = Module.cwrap('emStop', null, []);
      function cancelEmulation() {
        try {
          stopEmulation();
        } catch (e) {
          if (e.name == "ExitStatus") {
            // Success!
            hasRomLoaded = false;
          } else {
            console.error("Error while cancelling the emulator:", e);
          }
        }
        return false;
      }
      function onSubmit() {
        if (hasRomLoaded) {
          cancelEmulation();
        }
        const { value } = document.getElementById('fileNameInput');
        try {
          loadRom(`./rom/${value}.ch8`);
        } catch (e) {
          if (e.name == "ExitStatus") {
            hasRomLoaded = true;
          } else {
            console.error("Error launching the emulator:", e);
          }
        }
        return false;
      }
    </script>
  </body>
</html>
